function countYears(t,e,r="floor"){return Math[r]((e-t)/31536e6)}class ParsePrintedData{constructor(t){this.data=t}id(){return this.data.id}faculty(){return this.data.faculty}fio(){var{surname:t,name:e,lastname:r}=this.data;return t+` ${e} `+r}birthday(){var t=this.data.birthday,e=new Date,t=new Date(t),e=countYears(t,e);return t.toLocaleDateString().replaceAll("/",".")+` (${e} лет)`}studyStart(){var t=this.data.studyStart,e=new Date,r=new Date(t,8,1),r=countYears(r,e,"ceil")<=4?countYears(r,e,"ceil")+" курс":"Закончил";return`${t}-${parseInt(t)+4} (${r})`}}class SortUsers{constructor(t){this.users=t}id(){return this.users.sort((t,e)=>parseInt(t.id)-parseInt(e.id))}fio(){return this.users.sort((t,e)=>{t=new ParsePrintedData(t).fio(),e=new ParsePrintedData(e).fio();return t.localeCompare(e)})}birthday(){return this.users.sort((t,e)=>Date.parse(t.birthday)-Date.parse(e.birthday))}studyStart(){return this.users.sort((t,e)=>parseInt(t.studyStart)-parseInt(e.studyStart))}faculty(){return this.users.sort((t,e)=>t.faculty.localeCompare(e.faculty))}}class Users{static url="http://localhost:3000/api/students";static async sendUser(t){try{var e={method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}};return(await fetch(this.url,e)).status}catch(t){console.log(t)}}static async deleteUser(t){try{var e={method:"DELETE"};return(await fetch(this.url+"/"+t,e)).status}catch(t){console.log(t)}}constructor(t=[]){this.data=t,this.users_list}async getUsers(t=""){try{var e=await(await fetch(Users.url+"?search="+t)).json();""==t&&(this.data=e),this.printUsers(e)}catch(t){console.log(t)}}printUsers(t=this.data){if(0!=t.length){this.users_list=t,document.querySelectorAll(".user").forEach(t=>t.remove());let s=document.getElementById("temp-user_row").content,a=document.getElementById("table-body"),n=["id","fio","birthday","studyStart","faculty"];t.forEach(t=>{let e=s.cloneNode(!0),r=new ParsePrintedData(t);n.forEach(t=>{e.querySelector("."+t).textContent=r[t]()}),e.querySelector(".actions").setAttribute("id",t.id),e.querySelector(".delete_user").addEventListener("click",eventDelete),a.appendChild(e)})}}sort(t){var e=new SortUsers(this.users_list);this.printUsers(e[t]())}}let users=new Users;function setMaxDateForm(){var t=new Date,e=document.querySelector('[name="birthday"]'),r=document.querySelector('[name="studyStart"]');e.max=t.toLocaleDateString().replaceAll("/","-"),r.max=t.getFullYear()}function eventForm(t){t.preventDefault();let r=t.target,s={};["name","surname","lastname","birthday","studyStart","faculty"].forEach(t=>{var e=r.querySelector(`[name="${t}"]`).value;s[t]="birthday"==t?new Date(e).toISOString():e}),Users.sendUser(s),users.getUsers()}function eventDelete(t){t=t.target.parentNode.getAttribute("id");Users.deleteUser(t),users.getUsers()}function eventSearch(t){var t=t.target.parentNode.firstChild,e=t.value;t.value="",users.getUsers(e)}document.querySelectorAll(".t-head").forEach(e=>{e.addEventListener("click",t=>{document.querySelectorAll("th").forEach(t=>t.classList.remove("th_selected")),t.target.classList.add("th_selected");t=e.dataset.name;users.sort(t)})}),document.getElementById("form").addEventListener("submit",eventForm),document.getElementById("find-user").addEventListener("click",eventSearch),document.getElementById("find-user_reset").addEventListener("click",t=>{users.printUsers(),t.target.parentNode.firstChild.value=""}),document.addEventListener("DOMContentLoaded",async t=>{setMaxDateForm(),users.getUsers()});