class Users{static url="http://localhost:3000/api/students";static async sendUser(e){try{var t={method:"POST",body:JSON.stringify(e),"Content-Type":"application/json"};return(await fetch(this.url,t)).status}catch(e){console.log(e)}}static async deleteUser(e){try{var t={method:"DELETE"};return(await fetch(this.url+"/"+e,t)).status}catch(e){console.log(e)}}constructor(e=[]){this.users_list=e}async getUsers(e=""){try{var t=await(await fetch(Users.url+"?search="+e)).json();""==e&&(this.users_list=t),this.printUsers(t)}catch(e){console.log(e)}}printUsers(e=this.users_list){if(0!=e.length){document.querySelectorAll(".user").forEach(e=>e.remove());let n=document.getElementById("temp-user_row").content,s=document.getElementById("table-body"),a={independent:["id","faculty"],fio:["surname","name","lastname"],custom:{birthday:function(e){var t=new Date,t=o(e=new Date(e),t);return e.toLocaleDateString().replaceAll("/",".")+` (${t} лет)`},studyStart:function(e){var t=new Date,r=o(r=new Date(e,8,1),t,"ceil")<=4?o(r,t,"ceil")+" курс":"Закончил";return`${e}-${parseInt(e)+4} (${r})`}}};function o(e,t,r="floor"){return Math[r]((t-e)/31536e6)}e.forEach(t=>{let r=n.cloneNode(!0);var e=a.fio.map(e=>t[e]).join(" ");a.independent.forEach(e=>{r.querySelector("."+e).textContent=t[e]}),r.querySelector(".fio").textContent=e,Object.keys(a.custom).forEach(e=>{r.querySelector("."+e).textContent=a.custom[e](t[e])}),r.querySelector(".actions").setAttribute("id",t.id),r.querySelector(".delete_user").addEventListener("click",eventDelete),s.appendChild(r)})}}sort(){}}let users=new Users;function setMaxDateForm(){var e=new Date,t=document.querySelector('[name="birthday"]'),r=document.querySelector('[name="studyStart"]');t.max=e.toLocaleDateString().replaceAll("/","-"),r.max=e.getFullYear()}function eventForm(e){e.preventDefault();let r=e.target,n={};["name","surname","lastname","birthday","studyStart","faculty"].forEach(e=>{var t=r.querySelector(`[name="${e}"]`).value;n[e]="birthday"==e?new Date(t).toISOString():t}),Users.sendUser(n),users.getUsers()}function eventDelete(e){e=e.target.parentNode.getAttribute("id");Users.deleteUser(e),users.getUsers()}function eventSearch(e){var e=e.target.parentNode.firstChild,t=e.value;e.value="",users.getUsers(t)}document.getElementById("form").addEventListener("submit",eventForm),document.getElementById("find-user").addEventListener("click",eventSearch),document.getElementById("find-user_reset").addEventListener("click",e=>{users.printUsers(),e.target.parentNode.firstChild.value=""}),document.addEventListener("DOMContentLoaded",async e=>{setMaxDateForm(),users.getUsers()});