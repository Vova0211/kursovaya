function countYears(e,t,r="floor"){return Math[r]((t-e)/31536e6)}class ParsePrintedData{constructor(e){this.data=e}id(){return this.data.id}faculty(){return this.data.faculty}fio(){var{surname:e,name:t,lastname:r}=this.data;return e+` ${t} `+r}birthday(){var e=this.data.birthday,t=new Date,e=new Date(e),t=countYears(e,t);return e.toLocaleDateString().replaceAll("/",".")+` (${t} лет)`}studyStart(){var e=this.data.studyStart,t=new Date,r=new Date(e,8,1),r=countYears(r,t,"ceil")<=4?countYears(r,t,"ceil")+" курс":"Закончил";return`${e}-${parseInt(e)+4} (${r})`}}class SortUsers{constructor(e){this.users=e}id(){}fio(){}birthday(){}studyStart(){}faculty(){}}class Users{static url="http://localhost:3000/api/students";static async sendUser(e){try{var t={method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}};return(await fetch(this.url,t)).status}catch(e){console.log(e)}}static async deleteUser(e){try{var t={method:"DELETE"};return(await fetch(this.url+"/"+e,t)).status}catch(e){console.log(e)}}constructor(e=[]){this.users_list=e}async getUsers(e=""){try{var t=await(await fetch(Users.url+"?search="+e)).json();""==e&&(this.users_list=t),this.printUsers(t)}catch(e){console.log(e)}}printUsers(e=this.users_list){if(0!=e.length){document.querySelectorAll(".user").forEach(e=>e.remove());let s=document.getElementById("temp-user_row").content,a=document.getElementById("table-body"),n=["id","fio","birthday","studyStart","faculty"];e.forEach(e=>{let t=s.cloneNode(!0),r=new ParsePrintedData(e);n.forEach(e=>{t.querySelector("."+e).textContent=r[e]()}),t.querySelector(".actions").setAttribute("id",e.id),t.querySelector(".delete_user").addEventListener("click",eventDelete),a.appendChild(t)})}}sort(e){var t=this.users_list;t.sort({id:(e,t)=>parseInt(e.id)-parseInt(t.id),fio:(e,t)=>e.surname-t.surname,studyStart:(e,t)=>parseInt(e.studyStart)-parseInt(t.studyStart)}[e]),this.printUsers(t)}}let users=new Users;function setMaxDateForm(){var e=new Date,t=document.querySelector('[name="birthday"]'),r=document.querySelector('[name="studyStart"]');t.max=e.toLocaleDateString().replaceAll("/","-"),r.max=e.getFullYear()}function eventForm(e){e.preventDefault();let r=e.target,s={};["name","surname","lastname","birthday","studyStart","faculty"].forEach(e=>{var t=r.querySelector(`[name="${e}"]`).value;s[e]="birthday"==e?new Date(t).toISOString():t}),Users.sendUser(s),users.getUsers()}function eventDelete(e){e=e.target.parentNode.getAttribute("id");Users.deleteUser(e),users.getUsers()}function eventSearch(e){var e=e.target.parentNode.firstChild,t=e.value;e.value="",users.getUsers(t)}document.querySelectorAll(".t-head").forEach(r=>{r.addEventListener("click",e=>{var t=r.dataset.name;console.log(t),users.sort(t)})}),document.getElementById("form").addEventListener("submit",eventForm),document.getElementById("find-user").addEventListener("click",eventSearch),document.getElementById("find-user_reset").addEventListener("click",e=>{users.printUsers(),e.target.parentNode.firstChild.value=""}),document.addEventListener("DOMContentLoaded",async e=>{setMaxDateForm(),users.getUsers()});